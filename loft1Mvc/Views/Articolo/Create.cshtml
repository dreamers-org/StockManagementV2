@model StockManagement.Models.Articolo
@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor

@{
	ViewData["Title"] = "Inserimento nuovo articolo";
	Layout = "~/Views/Shared/_Layout.cshtml";
}

<h1>@ViewData["Title"]</h1>
<hr />
<div class="alert alert-danger" role="alert" style="display:none;" id="divError">
	Articolo già inserito in questa variante colore.
</div>
<div class="row">
	<div class=" col-sm-10 col-md-10 mx-auto mb-5">
		<div class="card border-left-primary shadow h-100">
			<div class="card-body">
				<form class="needs-validation" asp-action="Create">
					<div asp-validation-summary="ModelOnly" class="text-danger"></div>
					<div class="form-row justify-content-center">
						<div class="col-md-3 mb-3">
							<label asp-for="Codice" class="control-label"></label>
							<input asp-for="Codice" class="form-control" autocomplete="off" id="txtCodice" onblur="return getTxtValues();"/>
							<span asp-validation-for="Codice" class="text-danger"></span>
						</div>
						<div class="col-md-3 mb-3">
							<label asp-for="Descrizione" class="control-label"></label>
							<input asp-for="Descrizione" class="form-control" id="txtDescrizione" />
							<span asp-validation-for="Descrizione" class="text-danger"></span>
						</div>
						<div class="col-md-3 mb-3">
							<label asp-for="IdFornitore" class="control-label"></label>
							<select asp-for="IdFornitore" class="form-control" asp-items="ViewBag.IdFornitore" id="ddlFornitore"></select>
						</div>
						<div class="col-md-3 mb-3">
							<label asp-for="Colore" class="control-label"></label>
							<input asp-for="Colore" class="form-control" id="txtColore"  onblur="return verifyCorrectness();"  />
							<span asp-validation-for="Colore" class="text-danger"></span>
						</div>
					</div>
					<div class="form-row justify-content-center">
						<div class="col-md-1 mb-3">
							<label class="form-check-label">
								<input class="form-check-input" asp-for="Xxs" id="chkXXS" /> @Html.DisplayNameFor(model => model.Xxs)
							</label>
						</div>
						<div class="col-md-1 mb-3">
							<label class="form-check-label">
								<input class="form-check-input" asp-for="Xs" id="chkXS" /> @Html.DisplayNameFor(model => model.Xs)
							</label>
						</div>
						<div class="col-md-1 mb-3">
							<label class="form-check-label">
								<input class="form-check-input" asp-for="S" id="chkS" /> @Html.DisplayNameFor(model => model.S)
							</label>
						</div>
						<div class="col-md-1 mb-3">
							<label class="form-check-label">
								<input class="form-check-input" asp-for="M" id="chkM" /> @Html.DisplayNameFor(model => model.M)
							</label>
						</div>
						<div class="col-md-1 mb-3">
							<label class="form-check-label">
								<input class="form-check-input" asp-for="L" id="chkL" /> @Html.DisplayNameFor(model => model.L)
							</label>
						</div>
						<div class="col-md-1 mb-3">
							<label class="form-check-label">
								<input class="form-check-input" asp-for="Xl" id="chkXL" /> @Html.DisplayNameFor(model => model.Xl)
							</label>
						</div>
						<div class="col-md-1 mb-3">
							<label class="form-check-label">
								<input class="form-check-input" asp-for="Xxl" id="chkXXL" /> @Html.DisplayNameFor(model => model.Xxl)
							</label>
						</div>
						<div class="col-md-1 mb-3">
							<label class="form-check-label">
								<input class="form-check-input" asp-for="Xxxl" id="chkXXXL" /> @Html.DisplayNameFor(model => model.Xxxl)
							</label>
						</div>
						<div class="col-md-1 mb-3">
							<label class="form-check-label">
								<input class="form-check-input" asp-for="Xxxl" id="chkXXXL" /> @Html.DisplayNameFor(model => model.Xxxl)
							</label>
						</div>
						<div class="col-md-1 mb-3">
							<label class="form-check-label">
								<input class="form-check-input" asp-for="TagliaUnica" id="chkTagliaUnica" /> @Html.DisplayNameFor(model => model.TagliaUnica)
							</label>
						</div>
					</div>
					<div class="form-row justify-content-center">
						<div class="col-md-2 mb-3">
							<label asp-for="TrancheConsegna" class="control-label"></label>
							<input asp-for="TrancheConsegna" class="form-control" id="txtTrancheConsegna" />
							<span asp-validation-for="TrancheConsegna" class="text-danger"></span>
						</div>
						<div class="col-md-2 mb-3">
							<label asp-for="Genere" class="control-label"></label>
							@Html.DropDownListFor(p => p.Genere, new List<SelectListItem> {
							   new SelectListItem { Value = "Uomo" , Text = "Uomo" },
							   new SelectListItem { Value = "Donna" , Text = "Donna" },
							}, new { @class = "form-control", @id= "ddlGenereProdotto" })
							<span asp-validation-for="Genere" class="text-danger"></span>
						</div>
						<div class="col-md-2 mb-3">
							<label asp-for="IdTipo" class="control-label"></label>
							<select asp-for="IdTipo" class="form-control" asp-items="ViewBag.IdTipo" id="ddlTipoProdotto"></select>
						</div>
						<div class="col-md-2 mb-3">
							<label asp-for="PrezzoAcquisto" class="control-label"></label>
							<input asp-for="PrezzoAcquisto" class="form-control" id="txtPrezzoAcquisto" />
							<span asp-validation-for="PrezzoAcquisto" class="text-danger"></span>
						</div>
						<div class="col-md-2 mb-3">
							<label asp-for="PrezzoVendita" class="control-label"></label>
							<input asp-for="PrezzoVendita" class="form-control" id="txtPrezzoVendita" />
							<span asp-validation-for="PrezzoVendita" class="text-danger"></span>
						</div>
						<div class="col-md-2 mb-3">
							<label asp-for="IdCollezione" class="control-label"></label>
							<select asp-for="IdCollezione" class="form-control" asp-items="ViewBag.IdCollezione" id="ddlCollezione"></select>
						</div>
					</div>
					<div>
						<input type="submit" id="btnInserisci" value="Inserisci" style="height:100% !important" class="btn btn-lg btn-primary" disabled="disabled" />
						<a asp-action="create" class="btn btn-lg btn-danger">Annulla</a>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>

<div>
	<a asp-action="Index">Torna alla lista</a>
</div>

@section Scripts {

	<script type="text/javascript">
		function getTxtValues() {
			let codice = $('#txtCodice').val();
			$.ajax({
				type: "POST",
				url: "/Articolo/getTxtValues",
				data: { codice: codice },
				success: function (data) {
					console.log(data);
					if (data.fornitore) {
						$('.form-control').attr("readonly", "readonly");
						$('#txtColore').removeAttr("readonly");
						$('#txtDescrizione').attr("Value", data.descrizione);
						$('#txtPrezzoAcquisto').attr("Value", data.prezzoAcquisto);
						$('#txtPrezzoVendita').attr("Value", data.prezzoVendita);
						$('#txtTrancheConsegna').attr("Value", data.trancheConsegna);
						$('#ddlGenereProdotto').empty();
						$('#ddlGenereProdotto').append(new Option(data.genereProdotto, data.genereProdotto));
						$('#ddlGenereProdotto').val(data.genereProdotto);
						$('#ddlTipoProdotto').empty();
						$('#ddlTipoProdotto').append(new Option(data.tipoProdotto, data.idTipoProdotto));
						$('#ddlTipoProdotto').val(data.idTipoProdotto);
						$('#ddlFornitore').empty();
						$('#ddlFornitore').append(new Option(data.fornitore, data.idFornitore));
						$('#ddlFornitore').val(data.idFornitore);
						$('#ddlCollezione').empty();
						$('#ddlCollezione').append(new Option(data.collezione, data.idCollezione));
						$('#ddlCollezione').val(data.idCollezione);
					}
				},
				error: function () {
					alert("Errore");
				}
			})
		};

		function verifyCorrectness() {
			let codice = $('#txtCodice').val();
			let colore = $('#txtColore').val();
			$.ajax({
				type: "POST",
				url: "/Articolo/verifyCorrectness",
				data: { codice: codice, colore: colore },
				success: function (data) {
					console.log(data);
					if (!(data)) {
						$('#divError').show();
						$('#btnInserisci').attr("disabled", "disabled");
					}
					else {
						$('#divError').hide();
						$('#btnInserisci').removeAttr("disabled");
					}
				},
				error: function () {
					alert("Errore");
				}
			})
		};

	</script>
}
